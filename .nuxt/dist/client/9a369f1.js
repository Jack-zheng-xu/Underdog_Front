(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{445:function(e,t,n){var content=n(467);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(5).default)("be7977fe",content,!0,{sourceMap:!1})},466:function(e,t,n){"use strict";n(445)},467:function(e,t,n){var r=n(4)(!1);r.push([e.i,".msgScroll[data-v-d6c7eb56]::-webkit-scrollbar{width:5px;height:10px;background-color:#b5b1b1}.item[data-v-d6c7eb56]{background-color:#eee;margin:10px;border-radius:10px;align-items:center}.item[data-v-d6c7eb56],.show[data-v-d6c7eb56]{display:flex}.show[data-v-d6c7eb56]{margin-left:10px;flex:70%;flex-direction:column;justify-content:space-around}.operation[data-v-d6c7eb56]{width:100px;display:flex;justify-content:flex-end;align-items:center}.inputSearch[data-v-d6c7eb56]{margin:0 30px;flex:70%}.sousuo[data-v-d6c7eb56]{background-color:#eee;margin:10px;display:flex;align-items:center;height:70px}.u_guanzhu[data-v-d6c7eb56]{margin-bottom:30px!important;padding:10px;min-height:500px;background-color:#fff}.msgs[data-v-d6c7eb56]{height:87.5vh;padding:10upx;background-color:#eee;width:97%}.oneMsg[data-v-d6c7eb56]{line-height:2em}.other_user[data-v-d6c7eb56],.self-user[data-v-d6c7eb56]{color:#000}.field[data-v-d6c7eb56]{display:flex;flex-direction:row;align-items:center;margin:10upx}.field>.label[data-v-d6c7eb56]{width:4em;text-align:right}.textLine[data-v-d6c7eb56]{width:100%;display:flex;align-items:center;margin-bottom:10upx;margin-top:5px}.textTypeOwn[data-v-d6c7eb56]{background-color:#4cd964;color:#000}.textType[data-v-d6c7eb56],.textTypeOwn[data-v-d6c7eb56]{max-width:400upx;border-radius:10upx;box-shadow:3upx 3upx 3upx #e3e3e3;display:flex;align-items:center;justify-content:center;padding:10upx;flex-wrap:wrap}.textType[data-v-d6c7eb56]{background-color:#eee}.textType>view[data-v-d6c7eb56]{width:100%;font-size:28upx;color:#000;word-wrap:break-word;word-break:break-all;white-space:pre-line}.toLine[data-v-d6c7eb56]{color:#606266}.toLine>text[data-v-d6c7eb56]{background-color:#c0c4cc;margin:10upx}.scrollView[data-v-d6c7eb56]{width:750rpx}.inputStyle[data-v-d6c7eb56]{flex:80%}",""]),e.exports=r},517:function(e,t,n){"use strict";n.r(t);var r=n(3),c=(n(28),n(39),n(229),n(73)),o=function(e){return Object(c.a)({url:"/educenter/member/getUserByName/".concat(e),method:"get"})},d=function(e){return Object(c.a)({url:"/educenter/member/addFriend/".concat(e),method:"get"})},l=function(){return Object(c.a)({url:"/educenter/member/findFriendReqByUserid",method:"get"})},v=function(e){return Object(c.a)({url:"/educenter/member/acceptFriendReq/".concat(e),method:"get"})},m=function(){return Object(c.a)({url:"/educenter/member/getAllFriendByUserId",method:"get"})},f=function(e,t){return Object(c.a)({url:"/chat/chatRecord/findByUserIdAndFriendId/".concat(e,"/").concat(t),method:"get"})},h=function(e){return Object(c.a)({url:"/chat/chatRecord/getRecordByUserId/".concat(e),method:"get"})},_=function(e){return Object(c.a)({url:"/educenter/member/getUserInfoByIds",method:"post",data:e})},x={layout:"ucenterLayout",name:"",data:function(){return{messageValue:"",userId:"",friendId:"",type:0,flagdialog:"1",name:"",userList:[],userInfo:{},newsList:[],friendList:[],messageList:[],userAvatar:"",friendAvatar:"",path:"ws://127.0.0.1:110001/ws",socket:{},message:{type:0,tbChatRecord:{id:"",userId:"",friendId:"",msg:""},ext:""},unReadMessageList:[],UnUseList:[]}},mounted:function(){var e=this;this.init(),this.getUnReadMessageList(),this.socket.onmessage=function(t){console.log("收到服务器内容："+t.data);var n={type:2,msg:JSON.parse(t.data).tbChatRecord.message};e.messageList.push(n);var r,c=!1;r=JSON.parse(t.data).tbChatRecord.userId;for(var i=0;i<e.unReadMessageList.length;i++)if(r==e.unReadMessageList[i].name){e.unReadMessageList[i].count=e.unReadMessageList[i].count+1,c=!0;break}if(0==c){var o={};o.name=r,o.count=1,e.unReadMessageList.push(o)}}},methods:{GoPage:function(e){this.$router.push("/other/"+e)},getUnReadMessageList:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("safsafasas"+e.userId),t.next=3,h(e.userId);case 3:n=t.sent,e.unReadMessageList=n.data.data.list,console.log("未读消息"+e.unReadMessageList);case 6:case"end":return t.stop()}}),t)})))()},search:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o(e.name);case 2:n=t.sent,e.userList=n.data.data.list;case 4:case"end":return t.stop()}}),t)})))()},handleGuanzhu:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,d(e);case 2:r=n.sent,t.$message.success(r.data.message);case 4:case"end":return n.stop()}}),n)})))()},handleSelect:function(e){this.flagdialog=e,"5"===e&&this.getUserInfoByIds()},findFriendReqByUserid:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l();case 2:n=t.sent,e.newsList=n.data.data.list;case 4:case"end":return t.stop()}}),t)})))()},handleAgree:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,v(e);case 2:r=n.sent,console.log(r),2e4===r.data.code?(t.$message.success(r.data.message),t.flagdialog="3"):(t.$message.error(),r.data.message);case 5:case"end":return n.stop()}}),n)})))()},handleReject:function(){},getAllFriendByUserId:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m();case 2:n=t.sent,console.log(n),e.friendList=n.data.data.list,console.log(e.friendList);case 6:case"end":return t.stop()}}),t)})))()},toChat:function(e,t){this.friendId=e;var i=this.unReadMessageList.findIndex((function(t){return t.name==e}));this.unReadMessageList.splice(i),this.flagdialog="4",this.friendAvatar=t,this.getAllMessage(this.userId,e)},init:function(){var e=this;if("undefined"==typeof WebSocket)alert("您的浏览器不支持socket");else{var t=new WebSocket(this.path);console.log("saas"+t),this.socket=t,t.onopen=function(n){console.log("连接建立成功"),e.message.type=0,e.message.tbChatRecord.userId=e.userId,t.send(JSON.stringify(e.message))}}},getAllMessage:function(e,t){var n=this;return Object(r.a)(regeneratorRuntime.mark((function r(){var c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,f(e,t);case 2:c=r.sent,n.messageList=c.data.data.list,console.log(n.messageList);case 5:case"end":return r.stop()}}),r)})))()},sendMsg:function(){this.message.type=1,this.message.tbChatRecord.userId=this.userId,this.message.tbChatRecord.friendId=this.friendId,this.message.tbChatRecord.message=this.messageValue;var e={type:1,msg:this.messageValue};this.messageList.push(e),console.log(this.messageList),this.messageValue="",this.socket.send(JSON.stringify(this.message))},getUserInfoByIds:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,_(e.unReadMessageList);case 2:n=t.sent,e.UnUseList=n.data.data.list;case 4:case"end":return t.stop()}}),t)})))()}},computed:{unReadMessageCount:function(){for(var e=0,i=0;i<this.unReadMessageList.length;i++)e+=this.unReadMessageList[i].count;return e}},created:function(){this.findFriendReqByUserid(),this.getAllFriendByUserId(),this.userInfo=this.$store.state.userInfo,this.userId=this.userInfo.id,this.userAvatar=this.userInfo.avatar}},y=(n(466),n(11)),component=Object(y.a)(x,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container u_guanzhu"},[n("el-row",[n("el-col",{attrs:{span:4}},[n("el-menu",{staticClass:"el-menu-vertical-demo",attrs:{"default-active":"1","background-color":"#fff","text-color":"black","active-text-color":"#00baf2"},on:{select:e.handleSelect}},[n("el-menu-item",{attrs:{index:"1"}},[n("i",{staticClass:"el-icon-menu"}),e._v(" "),n("span",{attrs:{slot:"title"},slot:"title"},[e._v("添加好友")])]),e._v(" "),n("el-menu-item",{attrs:{index:"2"}},[n("i",{staticClass:"el-icon-document"}),e._v(" "),n("span",{attrs:{slot:"title"},slot:"title"},[e._v("新的朋友")])]),e._v(" "),n("el-menu-item",{attrs:{index:"3"}},[n("i",{staticClass:"el-icon-setting"}),e._v(" "),n("span",{attrs:{slot:"title"},slot:"title"},[e._v("我的关注")])]),e._v(" "),n("el-menu-item",{attrs:{index:"5"}},[n("i",{staticClass:"el-icon-message"}),e._v(" "),n("span",{attrs:{slot:"title"},slot:"title"},[e._v("您的消息\n            "),n("span",[e._v(e._s(e.unReadMessageCount))])])])],1)],1),e._v(" "),n("el-col",{attrs:{span:20}},["1"===e.flagdialog?n("div",[n("div",{staticClass:"sousuo"},[n("div",{staticClass:"inputSearch"},[n("el-input",{attrs:{placeholder:"请输入姓名"},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),e._v(" "),n("div",{staticStyle:{float:"left"}},[n("el-button",{attrs:{type:"primary",size:"small",round:""},on:{click:e.search}},[e._v("全站搜索")])],1)]),e._v(" "),n("div",e._l(e.userList,(function(t){return n("div",{key:t.id,staticClass:"item"},[n("div",{staticClass:"avatar"},[n("el-avatar",{attrs:{src:t.avatar}})],1),e._v(" "),n("div",{staticClass:"show"},[n("div",[e._v(e._s(t.nickname))]),e._v(" "),n("div",[e._v(e._s(t.signature||"TA很懒，什么都没有留下...."))])]),e._v(" "),n("div",{staticClass:"operation"},[n("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(n){return e.GoPage(t.id)}}},[e._v("进入Ta的主页")]),e._v(" "),n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(n){return e.handleGuanzhu(t.id)}}},[e._v("关注")]),e._v(" "),n("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(n){return e.handleLahei(t.id)}}},[e._v("拉黑")])],1)])})),0)]):e._e(),e._v(" "),"2"===e.flagdialog?n("div",e._l(e.newsList,(function(t){return n("div",{key:t.id,staticClass:"item"},[n("div",{staticClass:"avatar"},[n("el-avatar",{attrs:{src:t.avatar}})],1),e._v(" "),n("div",{staticClass:"show"},[n("div",[e._v(e._s(t.nickname))]),e._v(" "),n("div",[e._v(e._s(t.signature||"TA很懒，什么都没有留下...."))])]),e._v(" "),n("div",{staticClass:"operation"},[n("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(n){return e.GoPage(t.id)}}},[e._v("进入Ta的主页")]),e._v(" "),n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(n){return e.handleAgree(t.reqId)}}},[e._v("同意")]),e._v(" "),n("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(n){return e.handleReject(t.reqId)}}},[e._v("拒绝")])],1)])})),0):e._e(),e._v(" "),"3"===e.flagdialog?n("div",e._l(e.friendList,(function(t){return n("div",{key:t.id,staticClass:"item",on:{click:function(n){return e.toChat(t.id,t.avatar)}}},[n("div",{staticClass:"avatar"},[n("el-avatar",{attrs:{src:t.avatar}})],1),e._v(" "),n("div",{staticClass:"show"},[n("div",[e._v(e._s(t.nickname))]),e._v(" "),n("div",[e._v(e._s(t.signature||"TA很懒，什么都没有留下...."))])]),e._v(" "),n("div",{staticClass:"operation"},[n("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(n){return e.GoPage(t.id)}}},[e._v("进入Ta的主页")])],1)])})),0):e._e(),e._v(" "),"4"===e.flagdialog?n("div",[n("div",{staticClass:"msgScroll",attrs:{id:"msg"}},e._l(e.messageList,(function(t,r){return n("div",{key:r,staticClass:"oneMsg"},[1==t.type?n("div",{staticClass:"textLine textUser",staticStyle:{"flex-direction":"row-reverse"}},[n("el-avatar",{staticStyle:{"margin-left":"5px"},attrs:{src:e.userAvatar,shape:"square",size:27}}),e._v(" "),n("text",{staticStyle:{margin:"0 10upx"}},[e._v(":")]),e._v(" "),n("div",{staticClass:"textTypeOwn"},[n("div",{staticClass:"other_user"},[e._v(e._s(t.msg))])])],1):e._e(),e._v(" "),2==t.type?n("div",{staticClass:"textLine textFriend"},[n("el-avatar",{staticStyle:{"margin-right":"5px"},attrs:{src:e.friendAvatar,shape:"square",size:27}}),e._v(" "),n("text",{staticStyle:{margin:"0 .5em"}},[e._v(":")]),e._v(" "),n("div",{staticClass:"textType"},[n("div",{staticClass:"self-user"},[e._v(e._s(t.msg))])])],1):e._e()])})),0),e._v(" "),n("div",{staticClass:"sousuo"},[n("div",{staticClass:"inputSearch"},[n("el-input",{attrs:{placeholder:"消息"},model:{value:e.messageValue,callback:function(t){e.messageValue=t},expression:"messageValue"}})],1),e._v(" "),n("div",{staticStyle:{float:"left"}},[n("el-button",{attrs:{type:"primary",size:"small",round:""},on:{click:e.sendMsg}},[e._v("发送")])],1)])]):e._e(),e._v(" "),"5"===e.flagdialog?n("div",e._l(e.UnUseList,(function(t){return n("div",{key:t.id,staticClass:"item",on:{click:function(n){return e.toChat(t.id,t.avatar)}}},[n("div",{staticClass:"avatar"},[n("el-avatar",{attrs:{src:t.avatar}})],1),e._v(" "),n("div",{staticClass:"show"},[n("div",[e._v(e._s(t.nickname))])]),e._v(" "),n("div",{staticClass:"operation"},[n("span",{staticStyle:{color:"teal","font-size":"15px","margin-right":"5px"}},[e._v("消息数量："+e._s(t.count))])])])})),0):e._e()])],1)],1)}),[],!1,null,"d6c7eb56",null);t.default=component.exports}}]);