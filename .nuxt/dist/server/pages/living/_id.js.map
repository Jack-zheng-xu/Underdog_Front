{"version":3,"file":"pages/living/_id.js","sources":["webpack:///./api/teacher.js","webpack:///./api/living.js","webpack:///./pages/living/_id.vue?d51c","webpack:///./pages/living/_id.vue?487e","webpack:///./pages/living/_id.vue?26f4","webpack:///./pages/living/_id.vue?9c23","webpack:///./pages/living/_id.vue","webpack:///./pages/living/_id.vue?0ff1","webpack:///./pages/living/_id.vue?9029"],"sourcesContent":["import request from '@/utils/request'\r\nexport default {\r\n\r\n  getTeacherList(page,limit) {\r\n    return request({\r\n      url: `/eduservice/teacherfront/getTeacherFrontList/${page}/${limit}`,\r\n      method: 'post'\r\n    })\r\n  },\r\n  getTeacherInfo(id) {\r\n    return request({\r\n      url: `/eduservice/teacherfront/getTeacherFrontInfo/${id}`,\r\n      method: 'get'\r\n    })\r\n  },\r\n \r\n\r\n}","import request from '@/utils/request'\r\nexport default {\r\n\r\n  getAllLiving(){\r\n    return request({\r\n      url: '/live/aliyunLive/getAllLiving',\r\n      method: 'get'\r\n    })\r\n  },\r\n  getLivingById(id){\r\n    return request({\r\n      url: '/live/aliyunLive/getLiveById/'+id,\r\n      method: 'get'\r\n    })\r\n  }\r\n}","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../node_modules/_css-loader@4.3.0@css-loader/dist/cjs.js??ref--3-oneOf-1-1!../../node_modules/_vue-loader@15.9.7@vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/_postcss-loader@3.0.0@postcss-loader/src/index.js??ref--3-oneOf-1-2!../../node_modules/_vue-loader@15.9.7@vue-loader/lib/index.js??vue-loader-options!./_id.vue?vue&type=style&index=0&id=ed835c84&scoped=true&lang=css&\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add CSS to SSR context\nvar add = require(\"!../../node_modules/_vue-style-loader@4.1.3@vue-style-loader/lib/addStylesServer.js\").default\nmodule.exports.__inject__ = function (context) {\n  add(\"33635750\", content, true, context)\n};","export * from \"-!../../node_modules/_vue-style-loader@4.1.3@vue-style-loader/index.js??ref--3-oneOf-1-0!../../node_modules/_css-loader@4.3.0@css-loader/dist/cjs.js??ref--3-oneOf-1-1!../../node_modules/_vue-loader@15.9.7@vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/_postcss-loader@3.0.0@postcss-loader/src/index.js??ref--3-oneOf-1-2!../../node_modules/_vue-loader@15.9.7@vue-loader/lib/index.js??vue-loader-options!./_id.vue?vue&type=style&index=0&id=ed835c84&scoped=true&lang=css&\"","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../node_modules/_css-loader@4.3.0@css-loader/dist/runtime/api.js\");\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(false);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".chat[data-v-ed835c84]{overflow-y:scroll;background-color:#eee;height:680px;max-height:680px}.sendLine[data-v-ed835c84]{display:flex;width:100%}.sendBox[data-v-ed835c84]{position:absolute;bottom:0}.rightBox[data-v-ed835c84]{background-color:#fff}.contentLiving[data-v-ed835c84],.rightBox[data-v-ed835c84]{max-height:700px}.living[data-v-ed835c84],.livingInfo[data-v-ed835c84]{display:flex}.livingInfo[data-v-ed835c84]{margin-left:10px;flex-direction:column;justify-content:space-around}.itemsbg[data-v-ed835c84]{background-color:#40e0d0;color:#fff!important;border-radius:10px}.items[data-v-ed835c84],.itemsbg[data-v-ed835c84]{margin-left:10px}.items[data-v-ed835c84]{margin-top:5px}.item[data-v-ed835c84]{color:#eee}.outline[data-v-ed835c84]{height:775px}.bg[data-v-ed835c84],.outline[data-v-ed835c84]{background-color:#35383e}.bg[data-v-ed835c84]{z-index:9999999}.msgs[data-v-ed835c84]{height:87.5vh;padding:10upx;background-color:#eee;width:97%}.oneMsg[data-v-ed835c84]{line-height:2em}.other_user[data-v-ed835c84],.self-user[data-v-ed835c84]{color:#000}.field[data-v-ed835c84]{display:flex;flex-direction:row;align-items:center;margin:10upx}.field>.label[data-v-ed835c84]{width:4em;text-align:right}.textLine[data-v-ed835c84]{width:100%;display:flex;align-items:center;margin-bottom:10upx;margin-top:5px}.textTypeOwn[data-v-ed835c84]{background-color:#4cd964;color:#000}.textType[data-v-ed835c84],.textTypeOwn[data-v-ed835c84]{max-width:400upx;border-radius:10upx;box-shadow:3upx 3upx 3upx #e3e3e3;display:flex;align-items:center;justify-content:center;padding:10upx;flex-wrap:wrap}.textType[data-v-ed835c84]{background-color:#eee}.textType>view[data-v-ed835c84]{width:100%;font-size:28upx;color:#000;word-wrap:break-word;word-break:break-all;white-space:pre-line}.toLine[data-v-ed835c84]{color:#606266}.toLine>text[data-v-ed835c84]{background-color:#c0c4cc;margin:10upx}.scrollView[data-v-ed835c84]{width:750rpx}.inputStyle[data-v-ed835c84]{flex:80%}\", \"\"]);\n// Exports\nmodule.exports = ___CSS_LOADER_EXPORT___;\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticStyle:{}},[_vm._ssrNode(\"<div class=\\\"fl col-8\\\" data-v-ed835c84>\",\"</div>\",[_vm._ssrNode(\"<link rel=\\\"stylesheet\\\" href=\\\"https://g.alicdn.com/de/prismplayer/2.8.1/skins/default/aliplayer-min.css\\\" data-v-ed835c84> <script charset=\\\"utf-8\\\" type=\\\"text/javascript\\\" src=\\\"https://g.alicdn.com/de/prismplayer/2.8.1/aliplayer-min.js\\\" data-v-ed835c84></script> \"),_vm._ssrNode(\"<div class=\\\"living\\\" data-v-ed835c84>\",\"</div>\",[_c('el-avatar',{attrs:{\"src\":_vm.teacherInfo.avatar,\"shape\":\"square\",\"size\":120}}),_vm._ssrNode(\" <div class=\\\"livingInfo\\\" data-v-ed835c84><div style=\\\"font-size:20px;font-weight:bold\\\" data-v-ed835c84>\"+_vm._ssrEscape(\"\\n          \"+_vm._s(_vm.livingInfo.livingName)+\"\\n        \")+\"</div> <div data-v-ed835c84>\"+_vm._ssrEscape(_vm._s(_vm.livingInfo.descption))+\"</div> <div data-v-ed835c84>\"+_vm._ssrEscape(\"讲师名:\"+_vm._s(_vm.livingInfo.teacherName))+\"</div></div> <div data-v-ed835c84>\"+_vm._ssrEscape(\"当前在线人数:\"+_vm._s(_vm.livingCount))+\"</div>\")],2),_vm._ssrNode(\" <div id=\\\"J_prismPlayer\\\" class=\\\"prism-player\\\" data-v-ed835c84></div>\")],2),_vm._ssrNode(\" \"),_vm._ssrNode(\"<div class=\\\"fl col-2 rightBox\\\" data-v-ed835c84>\",\"</div>\",[_vm._ssrNode(\"<div id=\\\"msg\\\" class=\\\"chat\\\" data-v-ed835c84>\",\"</div>\",_vm._l((_vm.messageList),function(item,index){return _vm._ssrNode(\"<div class=\\\"oneMsg\\\" data-v-ed835c84>\",\"</div>\",[(item.type == 1)?_vm._ssrNode(\"<div class=\\\"textLine textUser\\\" style=\\\"flex-direction:row-reverse;\\\" data-v-ed835c84>\",\"</div>\",[_c('el-avatar',{staticStyle:{\"margin-left\":\"5px\"},attrs:{\"src\":item.avatar,\"shape\":\"square\",\"size\":27}}),_vm._ssrNode(\" <text style=\\\"margin: 0 10upx;\\\" data-v-ed835c84>:</text> <div class=\\\"textTypeOwn\\\" data-v-ed835c84><div class=\\\"other_user\\\" data-v-ed835c84>\"+_vm._ssrEscape(_vm._s(item.msg))+\"</div></div>\")],2):_vm._e(),_vm._ssrNode(\" \"),(item.type == 2)?_vm._ssrNode(\"<div class=\\\"textLine textFriend\\\" data-v-ed835c84>\",\"</div>\",[_c('el-avatar',{staticStyle:{\"margin-right\":\"5px\"},attrs:{\"src\":item.avatar,\"shape\":\"square\",\"size\":27}}),_vm._ssrNode(\" <text style=\\\"margin: 0 .5em;\\\" data-v-ed835c84>:</text> <div class=\\\"textType\\\" data-v-ed835c84><div class=\\\"self-user\\\" data-v-ed835c84>\"+_vm._ssrEscape(_vm._s(item.msg))+\"</div></div>\")],2):_vm._e()],2)}),0),_vm._ssrNode(\" \"),_vm._ssrNode(\"<div class=\\\"sendBox\\\" data-v-ed835c84>\",\"</div>\",[_vm._ssrNode(\"<div class=\\\"sendLine\\\" data-v-ed835c84>\",\"</div>\",[_c('el-input',{staticStyle:{\"width\":\"230px\"},model:{value:(_vm.messageValue),callback:function ($$v) {_vm.messageValue=$$v},expression:\"messageValue\"}}),_vm._ssrNode(\" \"),_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":_vm.sendDanmu}},[_vm._v(\"发送\")])],2)])],2)],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport living from \"@/api/living\";\r\nimport teacherAPi from \"@/api/teacher\";\r\nimport cookie from \"js-cookie\";\r\nexport default {\r\n  layout: \"video\", //应用video布局\r\n  asyncData({ params, error }) {\r\n    return living.getLivingById(params.id).then(response => {\r\n      return {\r\n        livingInfo: response.data.data.livingInfo,\r\n        teacherId: params.id\r\n      };\r\n    });\r\n  },\r\n  data() {\r\n    return {\r\n      player: {},\r\n      flagIndex: -1,\r\n      path: \"ws://127.0.0.1:11000/living\",\r\n      teacherInfo: {},\r\n      message: {},\r\n      userInfo: {},\r\n      messageValue: \"\",\r\n      messageList: [],\r\n      livingCount:0\r\n    };\r\n  },\r\n  created() {\r\n    console.log(this.livingInfo);\r\n  },\r\n  methods: {\r\n    //初始化websocket\r\n    init: function() {\r\n      if (typeof WebSocket === \"undefined\") {\r\n        alert(\"您的浏览器不支持socket\");\r\n      } else {\r\n        // 实例化socket\r\n        var socket = new WebSocket(this.path);\r\n        this.socket = socket;\r\n        socket.onopen = res => {\r\n          console.log(\"连接建立成功\");\r\n          this.message.type = 0;\r\n          this.message.userId = this.userInfo.id;\r\n          this.message.livingId = this.livingInfo.id;\r\n          socket.send(JSON.stringify(this.message));\r\n        };\r\n      }\r\n    },\r\n    //获取讲师信息\r\n    async getTeacherInfo() {\r\n      const res = await teacherAPi.getTeacherInfo(this.teacherId);\r\n   \r\n      if (res.data.code === 20000) {\r\n        console.log( res.data.data.teacher)\r\n        this.teacherInfo = res.data.data.teacher;\r\n        console.log(this.teacherInfo)\r\n      }\r\n    },\r\n    sendDanmu() {\r\n      //从cookie获取用户信息\r\n      var userStr = cookie.get(\"underdogedu_ucenter\");\r\n      if (userStr == null || userStr == undefined || userStr == \"\") {\r\n        this.$router.push(\"/login\");\r\n      } else {\r\n        this.userInfo = JSON.parse(userStr);\r\n        this.message.type = 1;\r\n        this.message.userId = this.userInfo.id;\r\n        this.message.livingId = this.livingInfo.id;\r\n        this.message.message = this.messageValue;\r\n        this.message.userAvatar = this.userInfo.avatar;\r\n        this.socket.send(JSON.stringify(this.message));\r\n        let messageVo = {\r\n          type: 1,\r\n          msg: this.messageValue,\r\n          avatar: this.userInfo.avatar\r\n        };\r\n        this.messageList.push(messageVo);\r\n        this.messageValue=\"\"\r\n      }\r\n    }\r\n  },\r\n  mounted() {\r\n    this.getTeacherInfo();\r\n    this.init();\r\n    //页面渲染之后\r\n    this.player = new Aliplayer(\r\n      {\r\n        id: \"J_prismPlayer\",\r\n        width: \"100%\",\r\n        height: \"630px\",\r\n        videoWidth: \"100%\",\r\n        videoHeight: \"100%\",\r\n        // 以下可选设置\r\n        cover:\r\n          \"https://underdogedu.oss-cn-beijing.aliyuncs.com/%E7%B4%A0%E6%9D%90/1525939573202.jpg\", // 封面\r\n        qualitySort: \"asc\", // 清晰度排序\r\n        mediaType: \"video\", // 返回音频还是视频\r\n        autoplay: false, // 自动播放\r\n        isLive: true, // 直播\r\n        rePlay: false, // 循环播放\r\n        preload: true,\r\n        controlBarVisibility: \"hover\", // 控制条的显示方式：鼠标悬停\r\n        useH5Prism: false, // 播放器类型：html5\r\n        useFlashPrism: true, //指定使用Flash播放器\r\n        rtmpBufferTime: 0,\r\n        showBuffer: 0,\r\n        stashInitialSizeForFlv: 30, //H5播放flv时，初始缓存大小，只在直播下起作用。\r\n        source: this.livingInfo.pullUrl //rtmp格式的地址\r\n      },\r\n      function(player) {\r\n        player.play();\r\n      }\r\n    );\r\n    this.socket.onmessage = res => {\r\n      console.log(\"收到服务器内容：\" + res.data);\r\n       //从cookie获取用户信息\r\n      var userStr = cookie.get(\"underdogedu_ucenter\");\r\n      if (JSON.parse(res.data).userId != this.userInfo.id && userStr != null && userStr != undefined && userStr != \"\") {\r\n        let messageVo = {\r\n          type: 2,\r\n          msg: JSON.parse(res.data).message,\r\n          avatar: JSON.parse(res.data).userAvatar\r\n        };\r\n        this.messageList.push(messageVo);\r\n        this.livingCount=JSON.parse(res.data).count\r\n      }else{\r\n        this.livingCount=JSON.parse(res.data).count\r\n      }\r\n    };\r\n  }\r\n};\r\n","import mod from \"-!../../node_modules/_babel-loader@8.2.2@babel-loader/lib/index.js??ref--2-0!../../node_modules/_vue-loader@15.9.7@vue-loader/lib/index.js??vue-loader-options!./_id.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/_babel-loader@8.2.2@babel-loader/lib/index.js??ref--2-0!../../node_modules/_vue-loader@15.9.7@vue-loader/lib/index.js??vue-loader-options!./_id.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./_id.vue?vue&type=template&id=ed835c84&scoped=true&\"\nimport script from \"./_id.vue?vue&type=script&lang=js&\"\nexport * from \"./_id.vue?vue&type=script&lang=js&\"\nfunction injectStyles (context) {\n  \n  var style0 = require(\"./_id.vue?vue&type=style&index=0&id=ed835c84&scoped=true&lang=css&\")\nif (style0.__inject__) style0.__inject__(context)\n\n}\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/_vue-loader@15.9.7@vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  injectStyles,\n  \"ed835c84\",\n  \"4abf5774\"\n  \n)\n\nexport default component.exports"],"mappings":";;;;;;;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAAA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAdA;;;;;;;;ACDA;AAAA;AACA;AAEA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAAA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAdA;;;;;;;ACDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACXA;AAAA;AAAA;AAAA;;;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACNA;AACA;AACA;;;;;;;;;;;;;;;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AATA;AAWA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AACA;AAlDA;AACA;AAkDA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAtBA;AAwBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA9HA;;AC1EA;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;A","sourceRoot":""}